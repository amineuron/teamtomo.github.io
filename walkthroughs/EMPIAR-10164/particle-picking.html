
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Find particles on every VLP</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=62ba249389abaaa9ffc34bf36a076bdc1d65ee18" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=f31d14ad54b65d19161ba51d4ffff3a77ae00456"></script>
    <script src="../../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Particle pose optimisation" href="relion.html" />
    <link rel="prev" title="Initial model generation" href="ini-model.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  teamtomo.org
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../teamtomo/about.html">
   About the project
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../teamtomo/contributing/index.html">
   Contributing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../teamtomo/contributing/git_guide.html">
     A short guide to git(hub)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../teamtomo/contributing/screen-capture.html">
     Screen capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../teamtomo/contributing/wishlist.html">
     Wishlist
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../theory/cryo-et/index.html">
   Cryo-electron tomography
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../theory/cryo-et/tilt-schemes.html">
     Tilt-schemes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../theory/cryo-et/tilt-series-alignment.html">
     Tilt-series alignment
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../theory/subtomogram-averaging/index.html">
   Subtomogram averaging
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../theory/subtomogram-averaging/preprocessing/index.html">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../theory/subtomogram-averaging/particle-picking/index.html">
     Particle picking
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../theory/subtomogram-averaging/particle-picking/template-matching.html">
       Template matching
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../theory/subtomogram-averaging/particle-picking/geometrical-supports.html">
       Using a supporting geometry
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../theory/subtomogram-averaging/particle-picking/subboxing.html">
       Subboxing
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../theory/subtomogram-averaging/refinement/index.html">
     Refinement
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../theory/image-processing/introduction.html">
   Image processing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Walkthroughs
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="introduction.html">
   EMPIAR-10164 (HIV VLPs)
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="preparation.html">
     Download the data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2d-preprocessing.html">
     2D preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tilt-series-to-tomograms.html">
     Tilt-series to tomograms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="geometrical-picking.html">
     Geometrical particle picking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="ini-model.html">
     Initial model generation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Find particles on every VLP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="relion.html">
     Particle pose optimisation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="m.html">
     Multi-particle refinement
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  mini-tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../mini-tutorials/dynamo/index.html">
   Dynamo
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/simple-alignment.html">
     Simple subtomogram averaging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/extract-from-catalogue.html">
     Extracting particles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/dipoles-to-vesicles.html">
     Spherical vesicle picking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/dtmslice-controls.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       dtmslice
      </span>
     </code>
     viewing controls
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/interactive-mask-creation.html">
     Interactive mask creation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  computing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../computing/python/index.html">
   Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../computing/python/getting-started.html">
     Getting started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../computing/python/virtual-environments.html">
     Virtual environments
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../computing/python/useful-packages/useful-packages.html">
     Useful packages
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/dynamotable.html">
       dynamotable
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/emfile.html">
       emfile
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/eulerangles.html">
       eulerangles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/mrcfile.html">
       mrcfile
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/napari.html">
       napari
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/starfile.html">
       starfile
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../computing/matlab/index.html">
   MATLAB
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../computing/matlab/add-to-path.html">
     Adding scripts/functions to your PATH in
     <code class="docutils literal notranslate">
      <span class="pre">
       MATLAB
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../resources/literature/index.html">
   Literature
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/literature/protocols/protocols.html">
     Protocols
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/literature/reviews/reviews.html">
     Reviews
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/reviews/schur19.html">
       Schur - 2019
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/reviews/lucic08.html">
       Lučić - 2008
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/reviews/lucic05.html">
       Lučić - 2005
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/literature/book-chapters/book-chapters.html">
     Book chapters
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/book-chapters/subtomo-leigh19.html">
       Subtomogram averaging from cryo-electron tomograms - Leigh 2019
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/book-chapters/cryo-et-sta-wan16.html">
       Cryo-Electron Tomography and Subtomogram Averaging - Wan 2016
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/book-chapters/fiducial-alignments-mastronarde07.html">
       Fiducial Marker and Hybrid Alignment Methods for Single- and Double-axis Tomography - Mastronarde 2007
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../resources/cryoet-software/cryoet-software.html">
   Software packages
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/appion-protomo/appion-protomo.html">
     Appion-Protomo
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/cryolo/cryolo.html">
     crYOLO
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/dynamo/dynamo.html">
     Dynamo
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/dynamo/starters-guide.html">
       Starters guide
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/dynamo/advanced-starters-guide.html">
       Advanced starters guide
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/dynamo/tilt-series-alignment.html">
       Tilt-series alignment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/dynamo/PCA.html">
       PCA based classification
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/eman2/eman2.html">
     EMAN2
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/eman2/full-tutorial.html">
       Complete tutorial
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/eman2/segmentation.html">
       Neural-net based segmentation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/emclarity/emclarity.html">
     emClarity
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/emclarity/tutorial.html">
       tutorial
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/imod/imod.html">
     IMOD
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
    <label for="toctree-checkbox-17">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/imod/tomo-guide.html">
       Tomography guide
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/imod/etomo-fiducial-tuto.html">
       Etomo with fiducials
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/imod/etomo-patch-track-tuto.html">
       Patch tracking in Etomo
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/imod/batch-alignment.html">
       Batch tilt-series alignment
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/m/m.html">
     M
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/m/user-guide.html">
       Warp/M
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/novactf/novactf.html">
     NovaCTF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/novasta/novasta.html">
     NovaSTA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/peet/peet.html">
     PEET
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/pytom/pytom.html">
     PyTom
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/relion/relion.html">
     RELION
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/stopgap/stopgap.html">
     STOPGAP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/topaz_denoise_3d/topaz_denoise_3d.html">
     Topaz Denoise 3D
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/warp/warp.html">
     Warp
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/warp/user-guide.html">
       Warp/M
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/teamtomo/teamtomo.github.io"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/teamtomo/teamtomo.github.io/issues/new?title=Issue%20on%20page%20%2Fwalkthroughs/EMPIAR-10164/particle-picking.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/teamtomo/teamtomo.github.io/edit/master/./walkthroughs/EMPIAR-10164/particle-picking.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/walkthroughs/EMPIAR-10164/particle-picking.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#particle-extraction">
   Particle extraction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#particle-alignment">
   Particle alignment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cleaning-the-dataset-based-on-geometrical-constraints">
   Cleaning the dataset based on geometrical constraints
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Find particles on every VLP</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#particle-extraction">
   Particle extraction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#particle-alignment">
   Particle alignment
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#cleaning-the-dataset-based-on-geometrical-constraints">
   Cleaning the dataset based on geometrical constraints
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="find-particles-on-every-vlp">
<h1>Find particles on every VLP<a class="headerlink" href="#find-particles-on-every-vlp" title="Permalink to this headline">#</a></h1>
<p><em>“What do we know and how can we use it?”</em></p>
<p>We now have</p>
<ul class="simple">
<li><p>initial estimates for the particle positions and orientations on the surface of every VLP</p></li>
<li><p>a good initial model centered on the 6-fold symmetry axis of the lattice structure.</p></li>
</ul>
<p>We can use this information to run a one iteration subtomogram averaging project. This should allow us to find a good set of particle positions and orientations, centered on the 6-fold symmetry axes, which we can later use for higher resolution reconstruction.</p>
<section id="particle-extraction">
<h2>Particle extraction<a class="headerlink" href="#particle-extraction" title="Permalink to this headline">#</a></h2>
<p>Unless you already did it after <a class="reference internal" href="ini-model.html#hiv-extract-subset"><span class="std std-ref">extracting a subset of particles</span></a>, you will need to extract the whole dataset. Follow the <a class="reference internal" href="../../mini-tutorials/dynamo/extract-from-catalogue.html"><span class="doc std std-doc">same procedure</span></a>, but use all the volumes and use as a base name <code class="docutils literal notranslate"><span class="pre">findparticles</span></code>.</p>
</section>
<section id="particle-alignment">
<h2>Particle alignment<a class="headerlink" href="#particle-alignment" title="Permalink to this headline">#</a></h2>
<p>Next we set up a new alignment project using <code class="docutils literal notranslate"><span class="pre">dcp</span></code>. This time, the aim is to align each oversampled initial particle position to the closest real particle position in the lattice. The important difference compared to the previous step are:</p>
<ul class="simple">
<li><p>Input data should be the whole dataset, not the subset, and the the relative <code class="docutils literal notranslate"><span class="pre">.tbl</span></code> file.</p></li>
<li><p>Template should now be the aligned, symmetrised initial model that we generated in the last section: <code class="docutils literal notranslate"><span class="pre">dynamo/inimodel/ite_0008/averages/average_aligned_along_z_c6.em</span></code>.</p></li>
<li><p>We only want to run for one iteration. Now that we’re working with the full dataset, calculations take significantly longer. Because our initial model is good one iteration of alignment should allow us to see the lattice structure appear in the particle positions.</p></li>
<li><p>We only want to perform local in plane and out of plane angular searches, since we are already fairly sure about our out of plane angles because they come from our <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> models. The in plane searches can be limited because of the C6 symmetry of the reference</p></li>
<li><p>We should adjust the shifts so that particles can only move half of the lattice spacing in the x and y direction. We expect to find a lattice of particles with roughly 7.5 nm spacing. If we allow each particle to shift a maximum of 4nm in each direction it should be guaranteed to find the closest true position in the lattice, without moving too far. This maximises the chances of finding all lattice positions from the beginning.</p></li>
<li><p>We should allow the particles to shift more in z than in x and y to account for any errors when defining our <code class="docutils literal notranslate"><span class="pre">Vesicle</span></code> models.</p></li>
</ul>
<a class="reference internal image-reference" href="../../_images/numerical-params2.png"><img alt="../../_images/numerical-params2.png" src="../../_images/numerical-params2.png" style="width: 500px;" /></a>
<p>Once the parameters are all set, run the project from the command line as before. This will take significantly longer that the previous time!</p>
</section>
<section id="cleaning-the-dataset-based-on-geometrical-constraints">
<h2>Cleaning the dataset based on geometrical constraints<a class="headerlink" href="#cleaning-the-dataset-based-on-geometrical-constraints" title="Permalink to this headline">#</a></h2>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The provided scripts are just a few lines long, and are given for convenience and illustration purposes. You are encouraged to read them and modify them for your own purposes.</p>
</div>
</aside>
<p>We can now take a look at the resulting particle positions, written in the output file <code class="docutils literal notranslate"><span class="pre">dynamo/findparticles/results/ite_0001/averages/refined_table_ref_001_ite_0001.tbl</span></code>.</p>
<p>We can use <a class="reference external" href="https://github.com/teamtomo/teamtomo.github.io/tree/master/walkthroughs/EMPIAR-10164/scripts/view_particles.m"><code class="docutils literal notranslate"><span class="pre">view_particles.m</span></code></a>  to open a 3D viewer and examine them. Open matlab in <code class="docutils literal notranslate"><span class="pre">dynamo/findparticles/results/ite_0001/</span></code> and run:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="b6b13501-d434-473d-9dd9-655dd79d9726" name="c71a7d23-716d-4388-bd26-d390cb13b481" type="radio">
</input><label class="sd-tab-label" for="b6b13501-d434-473d-9dd9-655dd79d9726">
Command</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">view_particles</span><span class="p">(</span><span class="s">&#39;refined_table_ref_001_ite_0001.tbl&#39;</span><span class="p">)</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="4c9018c1-924d-4f25-a067-771d3ccf8cf2" name="c71a7d23-716d-4388-bd26-d390cb13b481" type="radio">
</input><label class="sd-tab-label" for="4c9018c1-924d-4f25-a067-771d3ccf8cf2">
Source code</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="k">function</span><span class="w"> </span>gui<span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nf">view_particles</span><span class="p">(</span>table<span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% read the table</span><span class="w"></span>
<span class="w">    </span><span class="nb">table</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dread</span><span class="p">(</span><span class="nb">table</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="c">% get unique keys of each volume</span><span class="w"></span>
<span class="w">    </span><span class="nb">keys</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">unique</span><span class="p">(</span><span class="nb">table</span><span class="p">(:,</span><span class="w"> </span><span class="mi">20</span><span class="p">));</span><span class="w"></span>

<span class="w">    </span><span class="c">% open the viewer gui</span><span class="w"></span>
<span class="w">    </span><span class="n">gui</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mbgraph</span><span class="p">.</span><span class="n">montage</span><span class="p">();</span><span class="w"></span>

<span class="w">    </span><span class="c">% loop through volume keys</span><span class="w"></span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="n">key_idx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="nb">keys</span><span class="p">)</span><span class="w"></span>
<span class="w">        </span><span class="n">key</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">keys</span><span class="p">(</span><span class="n">key_idx</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c">% extract the table corresponding to this volume</span><span class="w"></span>
<span class="w">        </span><span class="n">idx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">table</span><span class="p">(:,</span><span class="w"> </span><span class="mi">20</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">key_idx</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">subtable</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">table</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span><span class="w"> </span><span class="p">:);</span><span class="w"></span>
<span class="w">        </span><span class="c">% draw the particles as points and lines</span><span class="w"></span>
<span class="w">        </span><span class="n">ax</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">gui</span><span class="p">.</span><span class="n">gca</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="n">sketch</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dpktbl</span><span class="p">.</span><span class="n">plots</span><span class="p">.</span><span class="n">sketch</span><span class="p">(</span><span class="n">subtable</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;haxis&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">ax</span><span class="p">);</span><span class="w"></span>
<span class="w">        </span><span class="c">% create a new frame for the next volume</span><span class="w"></span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="n">key_idx</span><span class="o">~=</span><span class="nb">size</span><span class="p">(</span><span class="nb">keys</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"></span>
<span class="w">            </span><span class="n">gui</span><span class="p">.</span><span class="n">step</span><span class="p">;</span><span class="w"></span>
<span class="w">        </span><span class="k">end</span><span class="w"></span>
<span class="w">    </span><span class="k">end</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can pan around the view by drag-n-dropping, zoom by scrolling, and change volume by clicking the <code class="docutils literal notranslate"><span class="pre">&gt;</span></code> and <code class="docutils literal notranslate"><span class="pre">&lt;</span></code> buttons.</p>
</div>
</aside>
<a class="reference internal image-reference" href="../../_images/particle-positions.png"><img alt="../../_images/particle-positions.png" src="../../_images/particle-positions.png" style="width: 600px;" /></a>
<p>As you can see, there are regions where particle positions appear to form regular lattices, and other smaller, more irregular regions. These disordered patches are likely due to irregularities in the VLP we annotated. To avoid including particles which do not contain our lattice structure, we should try to remove these particles at this stage.</p>
<p>However, the first cleaning step we should take is removing duplicate particles (remember, we oversampled the surface compared to the expected particle density!). To do so, we will use a simple matlab script, <a class="reference external" href="https://github.com/teamtomo/teamtomo.github.io/tree/master/walkthroughs/EMPIAR-10164/scripts/remove_duplicates.m"><code class="docutils literal notranslate"><span class="pre">remove_duplicates.m</span></code></a>.</p>
<p>To run, simply open MATLAB in <code class="docutils literal notranslate"><span class="pre">dynamo/findparticles/results/ite_0001/averages</span></code> and run:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="13a27f5e-da22-4182-9d86-9c4c5fbf3185" name="1bebee24-995c-43cb-a204-7d9880ec45a4" type="radio">
</input><label class="sd-tab-label" for="13a27f5e-da22-4182-9d86-9c4c5fbf3185">
Command</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">remove_duplicates</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="f2540025-40aa-4dca-8fcd-e8416397a09e" name="1bebee24-995c-43cb-a204-7d9880ec45a4" type="radio">
</input><label class="sd-tab-label" for="f2540025-40aa-4dca-8fcd-e8416397a09e">
Source code</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% read table</span><span class="w"></span>
<span class="nb">table</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dread</span><span class="p">(</span><span class="s">&#39;refined_table_ref_001_ite_0001.tbl&#39;</span><span class="p">);</span><span class="w"></span>

<span class="c">% remove duplicates</span><span class="w"></span>
<span class="n">threshold</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="n">nodup</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dpktbl</span><span class="p">.</span><span class="n">exclusionPerVolume</span><span class="p">(</span><span class="nb">table</span><span class="p">,</span><span class="w"> </span><span class="n">threshold</span><span class="p">)</span><span class="w"></span>

<span class="c">% write out table</span><span class="w"></span>
<span class="n">dwrite</span><span class="p">(</span><span class="n">nodup</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;result_10Apx_nodup.tbl&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>This will create a new table called <code class="docutils literal notranslate"><span class="pre">result_10Apx_nodup.tbl</span></code>, reducing clusters of multiple particles within 4 pixels (half the distance we measured earlier) to a single particle.</p>
<p>The next step is to remove particles that don’t belong to the lattice. To do so, we use <a class="reference external" href="https://github.com/teamtomo/teamtomo.github.io/tree/master/walkthroughs/EMPIAR-10164/scripts/check_radial_distribution.m"><code class="docutils literal notranslate"><span class="pre">check_radial_distribution.m</span></code></a>.</p>
<p>Once again, in the same directory, simply run:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="ccbf1468-0872-44b3-982f-44feb96f19b3" name="430c9d23-f561-4a91-80bb-c7742e365005" type="radio">
</input><label class="sd-tab-label" for="ccbf1468-0872-44b3-982f-44feb96f19b3">
Command</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">check_radial_distribution</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="0af32a01-81f6-4741-801a-cd3e78993b56" name="430c9d23-f561-4a91-80bb-c7742e365005" type="radio">
</input><label class="sd-tab-label" for="0af32a01-81f6-4741-801a-cd3e78993b56">
Source code</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="c">% check number of neighbours in radial shells, 1 px thick shells</span><span class="w"></span>

<span class="c">% read table</span><span class="w"></span>
<span class="nb">table</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dread</span><span class="p">(</span><span class="s">&#39;result_10Apx_nodup.tbl&#39;</span><span class="p">);</span><span class="w"></span>

<span class="c">% check average number of neighbours in shells</span><span class="w"></span>
<span class="c">% initialise result vector</span><span class="w"></span>
<span class="n">neighbours_in_shells</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">zeros</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">);</span><span class="w"></span>
<span class="n">shell_starts</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">19</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="p">);</span><span class="w"></span>

<span class="c">% check number of neighbours in shell, count and append to result</span><span class="w"></span>
<span class="k">for</span><span class="w"> </span><span class="n">shell_start_idx</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="nb">size</span><span class="p">(</span><span class="n">shell_starts</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">)</span><span class="w"></span>
<span class="w">    </span><span class="n">min_dist</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">shell_starts</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">shell_start_idx</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">max_dist</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">min_dist</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>
<span class="w">    </span><span class="n">n_neighbours</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dtneighbours_in_range</span><span class="p">(</span><span class="nb">table</span><span class="p">,</span><span class="w"> </span><span class="n">min_dist</span><span class="p">,</span><span class="w"> </span><span class="n">max_dist</span><span class="p">);</span><span class="w"></span>
<span class="w">    </span><span class="n">neighbours_in_shells</span><span class="p">(</span><span class="n">shell_start_idx</span><span class="p">)</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="nb">mean</span><span class="p">(</span><span class="n">n_neighbours</span><span class="p">);</span><span class="w"></span>
<span class="k">end</span><span class="w"></span>

<span class="nb">plot</span><span class="p">(</span><span class="n">shell_starts</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="n">neighbours_in_shells</span><span class="p">)</span><span class="w"></span>

<span class="c">% plot shows most particles have more neighbours at 5.5-8.5px distance</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>This will open a plot of the radial distribution of neighbouring particles for the whole dataset. Here, we can see a high peak at around 7.5 px, and periodic peaks after that.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you are wondering why the second peak has two sub-peaks: it’s the honeycomb pattern! The second shell of neighbours is actually composed of two shells at slighly different distances.</p>
</div>
</aside>
<p><img alt="radial distribution" src="../../_images/radial-distance-profile.png" /></p>
<p>This confirms the previously measured interparticle distance and the fact that most particles slid into ordered positions in the lattice. We can use the first peak to select against particles that don’t conform to this distribution. The next script, <a class="reference external" href="https://github.com/teamtomo/teamtomo.github.io/tree/master/walkthroughs/EMPIAR-10164/scripts/subset_table_based_on_neighbours.m"><code class="docutils literal notranslate"><span class="pre">subset_table_based_on_neighbours.m</span></code></a>, removes all particles that don’t have at least 3 neighbours in the radial shell at distance 7.5 px. To use it, run:</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="1aa51619-e9d3-467a-ac2f-da80003fd367" name="c52e5c5a-35cb-4ee3-8f83-bf486a37662f" type="radio">
</input><label class="sd-tab-label" for="1aa51619-e9d3-467a-ac2f-da80003fd367">
Command</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">subset_table_based_on_neighbours</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="73b07ee7-bfa8-47e4-94ca-1f71f6056865" name="c52e5c5a-35cb-4ee3-8f83-bf486a37662f" type="radio">
</input><label class="sd-tab-label" for="73b07ee7-bfa8-47e4-94ca-1f71f6056865">
Source code</label><div class="sd-tab-content docutils">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">read</span> <span class="n">table</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">dread</span><span class="p">(</span><span class="s1">&#39;result_10Apx_nodup.tbl&#39;</span><span class="p">);</span>

<span class="o">%</span> <span class="n">calculate</span> <span class="n">neighbours</span> <span class="n">around</span> <span class="n">peak</span> <span class="n">at</span> <span class="mf">7.5</span><span class="n">px</span>
<span class="n">peak</span> <span class="o">=</span> <span class="mf">7.5</span><span class="p">;</span>
<span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="n">neighbours</span> <span class="o">=</span> <span class="n">dtneighbours_in_range</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">peak</span><span class="o">-</span><span class="n">delta</span><span class="p">,</span> <span class="n">peak</span><span class="o">+</span><span class="n">delta</span><span class="p">);</span>

<span class="o">%</span> <span class="n">see</span> <span class="n">which</span> <span class="n">particles</span> <span class="n">have</span> <span class="n">more</span> <span class="n">than</span> <span class="mi">3</span> <span class="n">neighbours</span><span class="p">,</span> <span class="n">save</span> <span class="k">as</span> <span class="n">indices</span> <span class="n">to</span>
<span class="o">%</span> <span class="n">access</span> <span class="n">table</span>
<span class="n">idx</span> <span class="o">=</span> <span class="n">neighbours</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">;</span>
<span class="n">subset</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="p">:);</span>

<span class="o">%</span> <span class="n">write</span> <span class="n">out</span> <span class="n">table</span>
<span class="n">dwrite</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="s1">&#39;result_10Apx_nodup_neighbourcleaning.tbl&#39;</span><span class="p">);</span>
<span class="n">compare_two_tables</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">subset</span><span class="p">);</span>

<span class="o">%</span> <span class="n">function</span> <span class="k">for</span> <span class="n">calculating</span> <span class="n">number</span> <span class="n">of</span> <span class="n">neighbours</span> <span class="ow">in</span> <span class="n">a</span> <span class="n">distance</span> <span class="nb">range</span>
<span class="n">function</span> <span class="n">n_neighbours</span> <span class="o">=</span> <span class="n">dtneighbours_in_range</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">min_dist</span><span class="p">,</span> <span class="n">max_dist</span><span class="p">)</span>
    <span class="o">%</span> <span class="n">read</span> <span class="n">table</span>
    <span class="k">if</span> <span class="n">ischar</span><span class="p">(</span><span class="n">table</span><span class="p">)</span>
        <span class="n">table</span> <span class="o">=</span> <span class="n">dread</span><span class="p">(</span><span class="n">table</span><span class="p">);</span>
    <span class="n">end</span>
    <span class="o">%</span> <span class="n">prep</span> <span class="n">output</span>
    <span class="n">n_neighbours</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
    <span class="o">%</span> <span class="n">get</span> <span class="n">unique</span> <span class="n">tomogram</span> <span class="n">index</span> <span class="n">values</span>
    <span class="n">tomogram_idxs</span> <span class="o">=</span> <span class="n">unique</span><span class="p">(</span><span class="n">table</span><span class="p">(:,</span><span class="mi">20</span><span class="p">));</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">:</span><span class="n">size</span><span class="p">(</span><span class="n">tomogram_idxs</span><span class="p">)</span>
        <span class="o">%</span> <span class="n">get</span> <span class="n">table</span> <span class="n">per</span> <span class="n">volume</span>
        <span class="n">tomo_idx</span> <span class="o">=</span> <span class="n">tomogram_idxs</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
        <span class="n">table_idx</span> <span class="o">=</span> <span class="n">table</span><span class="p">(:,</span> <span class="mi">20</span><span class="p">)</span> <span class="o">==</span> <span class="n">tomo_idx</span><span class="p">;</span>
        <span class="n">current_table</span> <span class="o">=</span> <span class="n">table</span><span class="p">(</span><span class="n">table_idx</span><span class="p">,</span> <span class="p">:);</span>
        <span class="o">%</span> <span class="n">get</span> <span class="n">xyz</span> <span class="n">coords</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">current_table</span><span class="p">(:,</span> <span class="mi">4</span><span class="p">:</span><span class="mi">6</span><span class="p">)</span> <span class="o">+</span> <span class="n">current_table</span><span class="p">(:,</span> <span class="mi">24</span><span class="p">:</span><span class="mi">26</span><span class="p">);</span>
        <span class="o">%</span> <span class="n">get</span> <span class="n">neighbours</span> <span class="ow">in</span> <span class="nb">range</span>
        <span class="n">distance_matrix_</span> <span class="o">=</span> <span class="n">squareform</span><span class="p">(</span><span class="n">pdist</span><span class="p">(</span><span class="n">xyz</span><span class="p">));</span>
        <span class="n">neighbours_</span> <span class="o">=</span> <span class="n">distance_matrix_</span> <span class="o">&gt;=</span> <span class="n">min_dist</span> <span class="o">&amp;</span> <span class="n">distance_matrix_</span> <span class="o">&lt;=</span> <span class="n">max_dist</span><span class="p">;</span>
        <span class="n">n_neighbours_</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">neighbours_</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
        <span class="o">%</span> <span class="n">insert</span> <span class="ow">in</span> <span class="n">output</span>
        <span class="n">n_neighbours</span><span class="p">(</span><span class="n">table_idx</span><span class="p">)</span> <span class="o">=</span> <span class="n">n_neighbours_</span><span class="p">;</span>
    <span class="n">end</span>
<span class="n">end</span>
</pre></div>
</div>
</div>
</div>
<p>When finished, the script will open a viewer to inspect the table before and after the processing. Switching to a less clean dataset (for example <code class="docutils literal notranslate"><span class="pre">TS_43</span></code>) will make it clear that most bad particles were removed.</p>
<p>The final output is a new table called <code class="docutils literal notranslate"><span class="pre">result_10Apx_nodup_neighbourcleaning.tbl</span></code> which contains only references to the particles that we selected. This is our cleaned dataset, ready for refinement in <code class="docutils literal notranslate"><span class="pre">RELION</span></code>!</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./walkthroughs/EMPIAR-10164"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="ini-model.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Initial model generation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="relion.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Particle pose optimisation</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By the teamtomo.org contributors<br/>
  
      &copy; Copyright 2021.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>