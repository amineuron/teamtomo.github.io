
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Initial model generation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script src="../../_static/tabs.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"TeX": {"Macros": {"N": "\\mathbb{N}", "floor": ["\\lfloor#1\\rfloor", 1], "bmat": ["\\left[\\begin{array}"], "emat": ["\\end{array}\\right]"]}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Find particles on every VLP" href="particle-picking.html" />
    <link rel="prev" title="Geometrical particle picking" href="geometrical-picking.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.svg" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  teamtomo.org
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../teamtomo/about.html">
   About the project
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../teamtomo/contributing/index.html">
   Contributing
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../teamtomo/contributing/git_guide.html">
     A short guide to git(hub)
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../teamtomo/contributing/screen-capture.html">
     Screen capture
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../teamtomo/contributing/wishlist.html">
     Wishlist
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Theory
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../theory/cryo-et/index.html">
   Cryo-electron tomography
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../theory/cryo-et/tilt-schemes.html">
     Tilt-schemes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../theory/cryo-et/tilt-series-alignment.html">
     Tilt-series alignment
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../theory/subtomogram-averaging/index.html">
   Subtomogram averaging
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../theory/subtomogram-averaging/preprocessing/index.html">
     Preprocessing
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../theory/subtomogram-averaging/particle-picking/index.html">
     Particle picking
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
    <label for="toctree-checkbox-4">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../theory/subtomogram-averaging/particle-picking/template-matching.html">
       Template matching
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../theory/subtomogram-averaging/particle-picking/geometrical-supports.html">
       Using a supporting geometry
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../theory/subtomogram-averaging/particle-picking/subboxing.html">
       Subboxing
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../theory/subtomogram-averaging/refinement/index.html">
     Refinement
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../theory/image-processing/introduction.html">
   Image processing
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Walkthroughs
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="introduction.html">
   EMPIAR-10164 (HIV VLPs)
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="preparation.html">
     Download the data
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="2d-preprocessing.html">
     2D preprocessing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="tilt-series-to-tomograms.html">
     Tilt-series to tomograms
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="geometrical-picking.html">
     Geometrical particle picking
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Initial model generation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="particle-picking.html">
     Find particles on every VLP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="relion.html">
     Particle pose optimisation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="m.html">
     Multi-particle refinement
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  mini-tutorials
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../mini-tutorials/dynamo/index.html">
   Dynamo
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/simple-alignment.html">
     Simple subtomogram averaging
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/extract-from-catalogue.html">
     Extracting particles
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/dipoles-to-vesicles.html">
     Spherical vesicle picking
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/dtmslice-controls.html">
     <code class="docutils literal notranslate">
      <span class="pre">
       dtmslice
      </span>
     </code>
     viewing controls
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../mini-tutorials/dynamo/interactive-mask-creation.html">
     Interactive mask creation
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  computing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../computing/python/index.html">
   Python
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../computing/python/getting-started.html">
     Getting started
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../computing/python/virtual-environments.html">
     Virtual environments
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../computing/python/useful-packages/useful-packages.html">
     Useful packages
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
    <label for="toctree-checkbox-8">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/dynamotable.html">
       dynamotable
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/emfile.html">
       emfile
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/eulerangles.html">
       eulerangles
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/mrcfile.html">
       mrcfile
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/napari.html">
       napari
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../computing/python/useful-packages/starfile.html">
       starfile
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../computing/matlab/index.html">
   MATLAB
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" type="checkbox"/>
  <label for="toctree-checkbox-9">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../computing/matlab/add-to-path.html">
     Adding scripts/functions to your PATH in
     <code class="docutils literal notranslate">
      <span class="pre">
       MATLAB
      </span>
     </code>
    </a>
   </li>
  </ul>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Resources
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../resources/literature/index.html">
   Literature
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" type="checkbox"/>
  <label for="toctree-checkbox-10">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/literature/protocols/protocols.html">
     Protocols
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/literature/reviews/reviews.html">
     Reviews
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" type="checkbox"/>
    <label for="toctree-checkbox-11">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/reviews/schur19.html">
       Schur - 2019
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/reviews/lucic08.html">
       Lučić - 2008
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/reviews/lucic05.html">
       Lučić - 2005
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/literature/book-chapters/book-chapters.html">
     Book chapters
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" type="checkbox"/>
    <label for="toctree-checkbox-12">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/book-chapters/subtomo-leigh19.html">
       Subtomogram averaging from cryo-electron tomograms - Leigh 2019
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/book-chapters/cryo-et-sta-wan16.html">
       Cryo-Electron Tomography and Subtomogram Averaging - Wan 2016
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/literature/book-chapters/fiducial-alignments-mastronarde07.html">
       Fiducial Marker and Hybrid Alignment Methods for Single- and Double-axis Tomography - Mastronarde 2007
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../resources/cryoet-software/cryoet-software.html">
   Software packages
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" type="checkbox"/>
  <label for="toctree-checkbox-13">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/appion-protomo/appion-protomo.html">
     Appion-Protomo
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/cryolo/cryolo.html">
     crYOLO
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/dynamo/dynamo.html">
     Dynamo
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" type="checkbox"/>
    <label for="toctree-checkbox-14">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/dynamo/starters-guide.html">
       Starters guide
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/dynamo/advanced-starters-guide.html">
       Advanced starters guide
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/dynamo/tilt-series-alignment.html">
       Tilt-series alignment
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/dynamo/PCA.html">
       PCA based classification
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/eman2/eman2.html">
     EMAN2
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" type="checkbox"/>
    <label for="toctree-checkbox-15">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/eman2/full-tutorial.html">
       Complete tutorial
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/eman2/segmentation.html">
       Neural-net based segmentation
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/emclarity/emclarity.html">
     emClarity
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" type="checkbox"/>
    <label for="toctree-checkbox-16">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/emclarity/tutorial.html">
       tutorial
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/imod/imod.html">
     IMOD
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-17" name="toctree-checkbox-17" type="checkbox"/>
    <label for="toctree-checkbox-17">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/imod/tomo-guide.html">
       Tomography guide
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/imod/etomo-fiducial-tuto.html">
       Etomo with fiducials
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/imod/etomo-patch-track-tuto.html">
       Patch tracking in Etomo
      </a>
     </li>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/imod/batch-alignment.html">
       Batch tilt-series alignment
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/m/m.html">
     M
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-18" name="toctree-checkbox-18" type="checkbox"/>
    <label for="toctree-checkbox-18">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/m/user-guide.html">
       Warp/M
      </a>
     </li>
    </ul>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/novactf/novactf.html">
     NovaCTF
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/novasta/novasta.html">
     NovaSTA
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/peet/peet.html">
     PEET
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/pytom/pytom.html">
     PyTom
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/relion/relion.html">
     RELION
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/stopgap/stopgap.html">
     STOPGAP
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../resources/cryoet-software/topaz_denoise_3d/topaz_denoise_3d.html">
     Topaz Denoise 3D
    </a>
   </li>
   <li class="toctree-l2 has-children">
    <a class="reference internal" href="../../resources/cryoet-software/warp/warp.html">
     Warp
    </a>
    <input class="toctree-checkbox" id="toctree-checkbox-19" name="toctree-checkbox-19" type="checkbox"/>
    <label for="toctree-checkbox-19">
     <i class="fas fa-chevron-down">
     </i>
    </label>
    <ul>
     <li class="toctree-l3">
      <a class="reference internal" href="../../resources/cryoet-software/warp/user-guide.html">
       Warp/M
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/teamtomo/teamtomo.github.io"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/teamtomo/teamtomo.github.io/issues/new?title=Issue%20on%20page%20%2Fwalkthroughs/EMPIAR-10164/ini-model.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/teamtomo/teamtomo.github.io/edit/master/./walkthroughs/EMPIAR-10164/ini-model.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/walkthroughs/EMPIAR-10164/ini-model.md"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.md</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-a-subset-of-particles">
   Extracting a subset of particles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aligning-the-particles">
   Aligning the particles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assessing-the-results">
   Assessing the results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aligning-and-centering-the-6-fold-symmetry-axis">
   Aligning and centering the 6-fold symmetry axis
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Initial model generation</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#extracting-a-subset-of-particles">
   Extracting a subset of particles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aligning-the-particles">
   Aligning the particles
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#assessing-the-results">
   Assessing the results
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#aligning-and-centering-the-6-fold-symmetry-axis">
   Aligning and centering the 6-fold symmetry axis
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="initial-model-generation">
<h1>Initial model generation<a class="headerlink" href="#initial-model-generation" title="Permalink to this headline">#</a></h1>
<a class="reference internal image-reference" href="../../_images/hiv-initial-positions.png"><img alt="../../_images/hiv-initial-positions.png" src="../../_images/hiv-initial-positions.png" style="width: 250px;" /></a>
<p>Now that the Dynamo catalogue contains initial estimates for the positions and orientations of our particles, we need to obtain an initial model of our lattice structure which will later allow us to find more accurate estimates of the positions and orientations of our particles for the whole dataset. For this, we will work on a small subset of the VLPs.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Working on a small subset initially allows you to move quickly, testing lots of different approaches and optimising your approach. How small this subset should be will depend on the quality of your data, your initial particle picking and your object of interest.</p>
</div>
</aside>
<p>With data of such good quality and so many particles per VLP, two of our vesicle models should be more than enough for generating a good initial model of the underlying lattice structure.</p>
<p>When choosing an initial subset, it can be a good idea to choose VLPs with different defoci. This ensures that nodes of the CTF are at different spatial frequencies within the subset and thus no region of Fourier space should be particularly undersampled. The RELION team put together a useful <a class="reference external" href="https://3dem.github.io/relion/ctf.html">web app</a> which can be used to visualising the effect of changing CTF model parameters.</p>
<p>Choosing a subset which contains all available views of the particle is also important, ensuring maximum coverage of Fourier space in a resulting reconstruction</p>
<p>From the <code class="docutils literal notranslate"><span class="pre">Overview</span></code> tab in Warp, we quickly see that <code class="docutils literal notranslate"><span class="pre">TS_01</span></code> and <code class="docutils literal notranslate"><span class="pre">TS_03</span></code> have significantly different defoci, so we choose to use one vescicle from each of these tomograms.</p>
<section id="extracting-a-subset-of-particles">
<span id="hiv-extract-subset"></span><h2>Extracting a subset of particles<a class="headerlink" href="#extracting-a-subset-of-particles" title="Permalink to this headline">#</a></h2>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>A box sidelength of 32 corresponds to a 320<span class="math notranslate nohighlight">\(Å\)</span>. While this is much larger than the expected 75<span class="math notranslate nohighlight">\(Å\)</span> inter-particle distance, signal from neighbouring particles in lattices can help to drive correct alignments at the beginning of a project. When working at smaller pixel sizes a bigger box can also help to avoid CTF aliasing.</p>
</div>
</aside>
<p>Extract particles from your <code class="docutils literal notranslate"><span class="pre">Dynamo</span></code> catalogue with a sidelength of <code class="docutils literal notranslate"><span class="pre">32</span></code> following <a class="reference internal" href="../../mini-tutorials/dynamo/extract-from-catalogue.html"><span class="doc std std-doc">this mini-tutorial</span></a>. To make things faster, for now we can extract particles from one vesicle in <code class="docutils literal notranslate"><span class="pre">TS_01</span></code> and one in <code class="docutils literal notranslate"><span class="pre">TS_03</span></code>. We call this volume list file created at this stage <code class="docutils literal notranslate"><span class="pre">inimodel.vll</span></code>) and extract a data folder called <code class="docutils literal notranslate"><span class="pre">inimodelData.Boxes</span></code>.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Later, we will perform an alignment on particles from every VLP. You can save some time by launching a separate particle extraction for the whole dataset at this stage.</p>
</div>
</section>
<section id="aligning-the-particles">
<h2>Aligning the particles<a class="headerlink" href="#aligning-the-particles" title="Permalink to this headline">#</a></h2>
<p>Once the particle volumes are extracted for our two VLPs, we want to perform a first rough alignment to see how the particles align and average.</p>
<p>We run <code class="docutils literal notranslate"><span class="pre">dcp</span></code> from MATLAB to open the “Dynamo current project” GUI. This GUI is designed to be used in a sequential way: we will need to provide a few parameters before launching the project.</p>
<p>For a full tutorial on how to setting up a simple subtomogram averaging project in Dynamo, click <a class="reference internal" href="../../mini-tutorials/dynamo/simple-alignment.html"><span class="doc std std-doc">here</span></a>.</p>
<p>In our case, we set it up as follows:</p>
<p><code class="docutils literal notranslate"><span class="pre">project</span></code>
: we call our project <code class="docutils literal notranslate"><span class="pre">inimodel</span></code></p>
<p><code class="docutils literal notranslate"><span class="pre">particles</span></code>
: the <code class="docutils literal notranslate"><span class="pre">inimodelData.Boxes</span></code> Dynamo data folder.</p>
<p><code class="docutils literal notranslate"><span class="pre">table</span></code>
: the <code class="docutils literal notranslate"><span class="pre">inimodelData.Boxes/crop.tbl</span></code> particle metadata (table) file. When we cropped particles in the Dynamo catalogue, it created this metadata file for us and puts it inside the data folder. When selecting your table file, click <code class="docutils literal notranslate"><span class="pre">look</span> <span class="pre">inside</span> <span class="pre">data</span> <span class="pre">folder</span></code> and pick the <code class="docutils literal notranslate"><span class="pre">crop.tbl</span></code> file.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>While we don’t expect to see any detailed structure in this map, but it’s worth checking that it matches what we expect to see. If you right click on the file path at the top of the template GUI, you can choose to <code class="docutils literal notranslate"><span class="pre">[view]</span></code> the volume. Our initial picking contained no knowledge about the specific positions of each particle within the lattice. Because of this, we expect to see a curved, membrane like density and blurred density for the lattice proteins in the average.</p>
</div>
</aside>
<p><code class="docutils literal notranslate"><span class="pre">template</span></code>
: since we don’t have one, we generate one from a subset of our particles. Using 500 particles at this step is a good starting point. This will generate a reconstruction from 500 particles using our initial alignments from the vesicle model stored in the <code class="docutils literal notranslate"><span class="pre">crop.tbl</span></code> file.</p>
<a class="reference internal image-reference" href="../../_images/first-template-all.png"><img alt="../../_images/first-template-all.png" src="../../_images/first-template-all.png" style="width: 400px;" /></a>
<p><code class="docutils literal notranslate"><span class="pre">masks</span></code>
: <code class="docutils literal notranslate"><span class="pre">Use</span> <span class="pre">default</span> <span class="pre">masks</span></code> will give us appropriate masks at this stage that cover the full extent of our 32px box. At this stage, we aren’t very sure of our particle positions and orientations as they haven’t undergone any alignment. We want our mask to include the whole box so that signal from multiple neighbouring particles in the lattice can help to drive initial alignments.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Press <code class="docutils literal notranslate"><span class="pre">Alt</span></code> when a parameter is selected for a detailed description.</p>
</div>
</aside>
<p><code class="docutils literal notranslate"><span class="pre">numerical</span> <span class="pre">parameters</span></code>
: set the numerical parameters for the alignment procedure as shown below. Check out the <a class="reference internal" href="../../mini-tutorials/dynamo/simple-alignment.html"><span class="doc std std-doc">mini-tutorial</span></a> for a more in-depth explanation. At this stage, we don’t enforce symmetry during refinement. We hope that any symmetry present should appear after aligning our particles.</p>
<a class="reference internal image-reference" href="../../_images/numerical-params1.png"><img alt="../../_images/numerical-params1.png" src="../../_images/numerical-params1.png" style="width: 400px;" /></a>
<p>We perform initial alignments with only local out-of-plane searches (defined by the <code class="docutils literal notranslate"><span class="pre">cone</span> <span class="pre">range</span></code> parameter), making use of the initial estimates from our geometrical models.</p>
<a class="reference internal image-reference" href="../../_images/scanning-angles.png"><img alt="../../_images/scanning-angles.png" src="../../_images/scanning-angles.png" style="width: 400px;" /></a>
<p><code class="docutils literal notranslate"><span class="pre">computing</span> <span class="pre">environment</span></code>
: this will depend on your computing environment, including number of available CPUs/GPUs. We typically run projects in the <code class="docutils literal notranslate"><span class="pre">gpu_standalone</span></code> modus on 4 GPUs. Running in the standalone modus allows you to continue with other work in the matlab shell while the alignment project runs. In this modus, the number of CPU cores should be 1. The number of CPU cores used during averaging can be changed to the number of logical CPU cores on your machine. Specific GPUs can be selected by their index as seen in <code class="docutils literal notranslate"><span class="pre">nvidia-smi</span></code>.</p>
<p><code class="docutils literal notranslate"><span class="pre">check</span></code> and <code class="docutils literal notranslate"><span class="pre">unfold</span></code>
: run a sanity <code class="docutils literal notranslate"><span class="pre">check</span></code> to make sure the project seems correctly setup, then <code class="docutils literal notranslate"><span class="pre">unfold</span></code> to prepare an executable for the alignment project. If running a project on a remote machine without graphical access, a project can be set up locally and sent to the remote machine as a tarball. For information on this, please see <a class="reference external" href="https://wiki.dynamo.biozentrum.unibas.ch/w/index.php/Tarring_projects">this wiki page</a>.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can track the progress of the project from the <code class="docutils literal notranslate"><span class="pre">dcp</span></code> GUI by clicking on the <code class="docutils literal notranslate"><span class="pre">progress</span></code> button.</p>
</div>
</aside>
<p>We can now run the executable. To do so, open the <code class="docutils literal notranslate"><span class="pre">dynamo</span></code> directory in a terminal and run:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> <span class="nv">$DYNAMO_ROOT</span>/dynamo_activate_linux_shipped_MCR.sh
</pre></div>
</div>
<p>to prepare the environment. Then, simply execute:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>./inimodel.exe
</pre></div>
</div>
</section>
<section id="assessing-the-results">
<h2>Assessing the results<a class="headerlink" href="#assessing-the-results" title="Permalink to this headline">#</a></h2>
<p>We can look at the result of our first alignment project using tools from the <code class="docutils literal notranslate"><span class="pre">dcp</span></code> GUI under show. Alternatively, the file containing the average can be found at <code class="docutils literal notranslate"><span class="pre">dynamo/inimodel/results/ite_0008/averages/average_ref_001_ite_0008.em</span></code> and visualised with any volume visualisation tool.</p>
<p>In contrast to our previous reconstruction from particles with initial estimates for positions and orientations, in this map we clearly see a hexagonal lattice starting to take shape, containing 2-, 3- and 6-fold symmetry axes.</p>
<a class="reference internal image-reference" href="../../_images/first-aligned-all.png"><img alt="../../_images/first-aligned-all.png" src="../../_images/first-aligned-all.png" style="width: 400px;" /></a>
</section>
<hr class="docutils" />
<section id="aligning-and-centering-the-6-fold-symmetry-axis">
<h2>Aligning and centering the 6-fold symmetry axis<a class="headerlink" href="#aligning-and-centering-the-6-fold-symmetry-axis" title="Permalink to this headline">#</a></h2>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>By convention, rotational symmetry axes for <span class="math notranslate nohighlight">\(C_n\)</span> symmetries in electron microscopy software are aligned along the Z axis of the volume.</p>
</div>
</aside>
<p>In order to take advantage of the symmetry present in the structure during refinement we first need to recenter the average on its 6-fold symmetry axis and align that axis along the z axis of our volume.</p>
<p>To center and align the 6-fold symmetry axis, we will use a script provided with this tutorial, <a class="reference external" href="https://github.com/teamtomo/teamtomo.github.io/blob/master/walkthroughs/EMPIAR-10164/scripts/align_symmetry_axis.m"><code class="docutils literal notranslate"><span class="pre">align_symmetry_axis.m</span></code></a>. The script generates a synthetic template of a lattice with a 6-fold symmetry axis centered and aligned along the z-axis. The volume from our first subtomogram averaging experiment is then aligned to this synthetic template and C6 symmetry is applied. This produces an initial model with the symmetry axis correctly aligned for further experiments.</p>
<div class="sd-tab-set docutils">
<input checked="checked" id="251aed2f-8c8f-4288-92bb-0d2692bf30b0" name="5b17fdfb-dc9c-4e48-82b0-a8849e7c7843" type="radio">
</input><label class="sd-tab-label" for="251aed2f-8c8f-4288-92bb-0d2692bf30b0">
command</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">align_symmetry_axis</span><span class="w"></span>
</pre></div>
</div>
</div>
<input id="ccc3e0aa-a464-4e9b-bb63-02945cfa4c21" name="5b17fdfb-dc9c-4e48-82b0-a8849e7c7843" type="radio">
</input><label class="sd-tab-label" for="ccc3e0aa-a464-4e9b-bb63-02945cfa4c21">
source code</label><div class="sd-tab-content docutils">
<div class="highlight-matlab notranslate"><div class="highlight"><pre><span></span><span class="n">v</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dread</span><span class="p">(</span><span class="s">&#39;average_ref_001_ite_0008.em&#39;</span><span class="p">);</span><span class="w"></span>

<span class="n">rod_radius</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">2</span><span class="p">;</span><span class="w"></span>
<span class="n">rod_height</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">4</span><span class="p">;</span><span class="w"></span>
<span class="n">membrane_thickness</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">15</span><span class="p">;</span><span class="w"></span>
<span class="n">box_size</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">32</span><span class="p">;</span><span class="w"></span>

<span class="c">% Create fake membrane</span><span class="w"></span>
<span class="n">mr</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dpktomo</span><span class="p">.</span><span class="n">examples</span><span class="p">.</span><span class="n">motiveTypes</span><span class="p">.</span><span class="n">Membrane</span><span class="p">();</span><span class="w">   </span><span class="c">% create membrane object</span><span class="w"></span>
<span class="n">mr</span><span class="p">.</span><span class="n">thickness</span><span class="w">  </span><span class="p">=</span><span class="w"> </span><span class="n">membrane_thickness</span><span class="p">;</span><span class="w">       </span><span class="c">% choose thickness of membrane</span><span class="w"></span>
<span class="n">mr</span><span class="p">.</span><span class="n">sidelength</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">box_size</span><span class="p">;</span><span class="w"> </span><span class="c">% choose sidelength of box</span><span class="w"></span>
<span class="n">mr</span><span class="p">.</span><span class="n">fillData</span><span class="p">();</span><span class="w"></span>

<span class="n">mem</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mr</span><span class="p">.</span><span class="n">getData</span><span class="p">()</span><span class="o">.*-</span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="c">% Create cylinder in center to represent hole in center of structure to align to</span><span class="w"></span>
<span class="n">cyl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dynamo_cylinder</span><span class="p">([</span><span class="n">rod_radius</span><span class="p">,</span><span class="w"> </span><span class="nb">floor</span><span class="p">(</span><span class="n">rod_height</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mi">2</span><span class="p">)],</span><span class="w"> </span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="mi">21</span><span class="p">]);</span><span class="w"></span>
<span class="n">cyl</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dynamo_sym</span><span class="p">(</span><span class="n">cyl</span><span class="p">,</span><span class="w"> </span><span class="mi">9</span><span class="p">);</span><span class="w"></span>

<span class="n">cyl_shift</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dynamo_shift_rot</span><span class="p">(</span><span class="n">cyl</span><span class="p">,</span><span class="w"> </span><span class="p">[</span><span class="mi">8</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]);</span><span class="w"></span>
<span class="n">cyl_shift</span><span class="p">(</span><span class="nb">isnan</span><span class="p">(</span><span class="n">cyl_shift</span><span class="p">))</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"></span>
<span class="n">cyl_shift_sym</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dynamo_sym</span><span class="p">(</span><span class="n">cyl_shift</span><span class="p">,</span><span class="w"> </span><span class="mi">6</span><span class="p">)</span><span class="w"> </span><span class="o">.*</span><span class="w"> </span><span class="mi">6</span><span class="p">;</span><span class="w"></span>

<span class="c">% Combine membrane and hole</span><span class="w"></span>
<span class="n">template</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">mem</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cyl</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">cyl_shift_sym</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"></span>

<span class="c">% normalise both volumes</span><span class="w"></span>
<span class="n">template</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dynamo_normalize_roi</span><span class="p">(</span><span class="n">template</span><span class="p">);</span><span class="w"></span>
<span class="n">v</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dynamo_normalize_roi</span><span class="p">(</span><span class="n">v</span><span class="p">);</span><span class="w"></span>

<span class="c">% Align average to synthetic template</span><span class="w"></span>
<span class="n">sal</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dalign</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">template</span><span class="w"> </span><span class="p">,</span><span class="s">&#39;cr&#39;</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="s">&#39;cs&#39;</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="s">&#39;ir&#39;</span><span class="p">,</span><span class="mi">90</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;is&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">30</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;rf&#39;</span><span class="p">,</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;dim&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">box_size</span><span class="p">,</span><span class="s">&#39;limm&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="s">&#39;lim&#39;</span><span class="p">,[</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">4</span><span class="p">]);</span><span class="w"></span>
<span class="n">v_aligned</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">sal</span><span class="p">.</span><span class="n">aligned_particle</span><span class="p">;</span><span class="w"></span>
<span class="n">v_aligned_c6</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="n">dynamo_sym</span><span class="p">(</span><span class="n">v_aligned</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;c6&#39;</span><span class="p">);</span><span class="w"></span>

<span class="n">dmapview</span><span class="p">({</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">template</span><span class="p">,</span><span class="w"> </span><span class="n">v_aligned</span><span class="p">,</span><span class="w"> </span><span class="n">v_aligned_c6</span><span class="p">})</span><span class="w"></span>

<span class="c">% write out averages</span><span class="w"></span>
<span class="n">dwrite</span><span class="p">(</span><span class="n">template</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;synthetic_template.em&#39;</span><span class="p">);</span><span class="w"></span>
<span class="n">dwrite</span><span class="p">(</span><span class="n">v_aligned</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;average_aligned_along_z.em&#39;</span><span class="p">);</span><span class="w"></span>
<span class="n">dwrite</span><span class="p">(</span><span class="n">v_aligned_c6</span><span class="p">,</span><span class="w"> </span><span class="s">&#39;average_aligned_along_z_c6.em&#39;</span><span class="p">);</span><span class="w"></span>
</pre></div>
</div>
</div>
</div>
<p>To run the script, open <code class="docutils literal notranslate"><span class="pre">dynamo/inimodel/results/ite_0008/averages</span></code> in Matlab. Copy the script into this directory, and execute it by running <code class="docutils literal notranslate"><span class="pre">align_symmetry_axis</span></code>. Once the script has finished, compare the initial average, the template, the aligned average and the symmetrised aligned average to check that the alignment worked as intended.</p>
<a class="reference internal image-reference" href="../../_images/aligned-to-z.png"><img alt="../../_images/aligned-to-z.png" src="../../_images/aligned-to-z.png" style="width: 300px;" /></a>
<p>We now have an initial model with the 6-fold symmetry axis aligned to the center of the volume. We can use this initial model to obtain good estimates for particle positions and orientations of HIV-1 CA-SP1 hexamers for the whole dataset.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./walkthroughs/EMPIAR-10164"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="geometrical-picking.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Geometrical particle picking</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="particle-picking.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Find particles on every VLP</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By the teamtomo.org contributors<br/>
  
      &copy; Copyright 2021.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>